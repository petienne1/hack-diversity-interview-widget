{"ast":null,"code":"import _objectSpread from \"/Users/pierry/Desktop/Web Development/hack-diversity-interview-widget/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/pierry/Desktop/Web Development/hack-diversity-interview-widget/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _possibleConstructorReturn from \"/Users/pierry/Desktop/Web Development/hack-diversity-interview-widget/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/pierry/Desktop/Web Development/hack-diversity-interview-widget/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/pierry/Desktop/Web Development/hack-diversity-interview-widget/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _wrapNativeSuper from \"/Users/pierry/Desktop/Web Development/hack-diversity-interview-widget/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper\";\n\n/**************************************************\n*************** DO NOT EDIT THIS FILE *************\n**************************************************/\nvar MessageValidationError = /*#__PURE__*/function (_Error) {\n  _inherits(MessageValidationError, _Error);\n\n  function MessageValidationError() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, MessageValidationError);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(MessageValidationError)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.name = 'MessageValidationError';\n    return _this;\n  }\n\n  return MessageValidationError;\n}(_wrapNativeSuper(Error));\n\nvar InternalServerError = /*#__PURE__*/function (_Error2) {\n  _inherits(InternalServerError, _Error2);\n\n  function InternalServerError() {\n    var _getPrototypeOf3;\n\n    var _this2;\n\n    _classCallCheck(this, InternalServerError);\n\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    _this2 = _possibleConstructorReturn(this, (_getPrototypeOf3 = _getPrototypeOf(InternalServerError)).call.apply(_getPrototypeOf3, [this].concat(args)));\n    _this2.name = 'InternalServerError';\n    return _this2;\n  }\n\n  return InternalServerError;\n}(_wrapNativeSuper(Error));\n\nvar getFuzzyServerResponseDelay = function getFuzzyServerResponseDelay() {\n  var min = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 100;\n  var max = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 2000;\n  return Math.max(min, Math.min(Math.round(Math.random() * Math.random() * 1300), max));\n};\n\nvar authorId = Math.round(Math.random() * Math.random() * 100000);\nvar messageId = 0;\n\nvar createServerMessage = function createServerMessage(_ref) {\n  var message = _ref.message;\n  return _objectSpread({}, message, {\n    authorId: authorId,\n    createdAt: Date.now(),\n    id: ++messageId\n  });\n};\n\nvar getValidationError = function getValidationError(message) {\n  // only allow certain keys\n  var allowedKeys = new Set(['body', 'createdAt', 'context', 'id', 'authorId', 'attributes', 'conversationId']);\n  var givenKeys = new Set(Object.keys(message));\n  allowedKeys.forEach(function (key) {\n    return givenKeys.delete(key);\n  });\n\n  if (givenKeys.size) {\n    var invalidKeys = [];\n    givenKeys.forEach(function (invalidKey) {\n      return invalidKeys.push(invalidKey);\n    });\n    return new MessageValidationError(\"The keys [\".concat(invalidKeys.join(', '), \"] are not allowed to appear on a message\"));\n  } // require a body\n\n\n  if (!message.body) {\n    return new MessageValidationError('A message must have a \"body\"');\n  }\n};\n\nexport default {\n  sendMessage: function sendMessage(message) {\n    var response = new Promise(function (res, rej) {\n      var serverMessage = createServerMessage({\n        message: message\n      });\n      var apiSuccess = Math.random() > 0.1;\n      var validationError = getValidationError(message);\n\n      if (apiSuccess && !validationError) {\n        setTimeout(res.bind(null, {\n          messageFromServer: serverMessage\n        }), getFuzzyServerResponseDelay());\n      } else {\n        if (validationError) {\n          setTimeout(rej.bind(null, {\n            messageFromServer: serverMessage,\n            error: validationError\n          }), getFuzzyServerResponseDelay());\n        } else {\n          setTimeout(rej.bind(null, {\n            messageFromServer: serverMessage,\n            error: new InternalServerError(\"Server gave a 500\")\n          }), getFuzzyServerResponseDelay());\n        }\n      }\n    });\n    return response;\n  }\n};","map":{"version":3,"sources":["/Users/pierry/Desktop/Web Development/hack-diversity-interview-widget/src/modules/message/api.js"],"names":["MessageValidationError","name","Error","InternalServerError","getFuzzyServerResponseDelay","min","max","Math","round","random","authorId","messageId","createServerMessage","message","createdAt","Date","now","id","getValidationError","allowedKeys","Set","givenKeys","Object","keys","forEach","key","delete","size","invalidKeys","invalidKey","push","join","body","sendMessage","response","Promise","res","rej","serverMessage","apiSuccess","validationError","setTimeout","bind","messageFromServer","error"],"mappings":"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","sourcesContent":["\n/**************************************************\n*************** DO NOT EDIT THIS FILE *************\n**************************************************/\n\nclass MessageValidationError extends Error {\n  name = 'MessageValidationError'\n}\nclass InternalServerError extends Error {\n  name = 'InternalServerError'\n}\n\nconst getFuzzyServerResponseDelay = (min = 100, max = 2000) => (\n  Math.max(\n    min,\n    Math.min(\n      Math.round(Math.random() * Math.random() * 1300),\n      max\n    )\n  )\n);\n\nconst authorId = Math.round(Math.random() * Math.random() * 100000);\nlet messageId = 0;\n\nconst createServerMessage = ({ message }) => ({\n  ...message,\n  authorId,\n  createdAt: Date.now(),\n  id: ++messageId,\n});\n\nconst getValidationError = (message) => {\n\n  // only allow certain keys\n  const allowedKeys = new Set(['body', 'createdAt', 'context', 'id', 'authorId', 'attributes', 'conversationId']);\n  const givenKeys = new Set(Object.keys(message));\n  allowedKeys.forEach(key => givenKeys.delete(key))\n  if (givenKeys.size) {\n    const invalidKeys = [];\n    givenKeys.forEach(invalidKey => invalidKeys.push(invalidKey));\n    return new MessageValidationError(`The keys [${invalidKeys.join(', ')}] are not allowed to appear on a message`);\n  }\n\n  // require a body\n  if (!message.body) {\n    return new MessageValidationError('A message must have a \"body\"');\n  }\n}\n\nexport default {\n  sendMessage: (message) => {\n    const response = new Promise((res, rej) => {\n      const serverMessage = createServerMessage({ message });\n      const apiSuccess = Math.random() > 0.1;\n      const validationError = getValidationError(message);\n      if (apiSuccess && !validationError) {\n        setTimeout(res.bind(null, { messageFromServer: serverMessage }), getFuzzyServerResponseDelay());\n      } else {\n        if (validationError) {\n          setTimeout(rej.bind(null, { messageFromServer: serverMessage, error: validationError }), getFuzzyServerResponseDelay());\n        } else {\n          setTimeout(rej.bind(null, { messageFromServer: serverMessage, error: new InternalServerError(\"Server gave a 500\") }), getFuzzyServerResponseDelay());\n        }\n      }\n    });\n    return response;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}